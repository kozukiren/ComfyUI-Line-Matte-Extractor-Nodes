{
  "id": "08b865e8-9e42-4bfb-ab8d-26fdce791d4d",
  "revision": 0,
  "last_node_id": 30,
  "last_link_id": 21,
  "nodes": [
    {
      "id": 12,
      "type": "LineArtExtractor",
      "pos": [
        -154.36728981228126,
        3080.255792156428
      ],
      "size": [
        270,
        106
      ],
      "flags": {},
      "order": 10,
      "mode": 2,
      "inputs": [
        {
          "name": "image",
          "type": "IMAGE",
          "link": 8
        }
      ],
      "outputs": [
        {
          "name": "line_art",
          "type": "IMAGE",
          "links": [
            7,
            9
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "LineArtExtractor"
      },
      "widgets_values": [
        0.5,
        true,
        3
      ]
    },
    {
      "id": 21,
      "type": "Note",
      "pos": [
        -170.14479879873684,
        3241.9643106998687
      ],
      "size": [
        307.21272856576,
        583.6927000457945
      ],
      "flags": {},
      "order": 0,
      "mode": 2,
      "inputs": [],
      "outputs": [],
      "properties": {},
      "widgets_values": [
        "【ここは画像一枚ずつ透過させる機能のノードグループ】\n\n\nステップ①　画像を読み込む\n透過させたい画像をドラッグ&ドロップ\nor 「アップロードするファイルを選択」から選ぶ\n\n────────────────────────\n\nステップ②　透過具合を調整する\n\n【threshold（しきい値）】\nどの明るさまで「線」として残すかを決める値。\n\n小さい値（0.2〜0.4）\n→ 薄い線やグレー部分も線として残りやすい（でもノイズも増えがち）\n\n大きい値（0.6〜0.8）\n→ 濃い線だけ残って、薄い部分は透過になりやすい（クッキリだけど情報は減る）\n\n目安: まず 0.5 で試す\n線が薄くて消えがち → 少し下げる（0.35〜0.45）\nゴミが多い／ベタが残りすぎ → 少し上げる（0.6 前後）\n\n\n【tinvert_input（入力の白黒反転）】\n白い部分を透過させたい時はtrue\n\n\n\n【median_filter】\n\n小さいゴミ・点ノイズを消すためのぼかしの強さ。\n\n1：フィルタなし（処理がいちばん軽い）\n\n3：ちょっとだけノイズをならす（おすすめ初期値）\n\n5,7,9…：大きくするほどノイズは減るが、細かい線も丸くなりがち\n\n目安\n手描き線やスキャンっぽい素材 → 3〜5\nノイズがほぼないCG線 → 1\n\n────────────────────────\n\nステップ③ 画像を保存\n\nデフォルトではComfyUIのフォルダの中のoutputフォルダに保存される。"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 23,
      "type": "Note",
      "pos": [
        651.9196963241416,
        2581.7508873503252
      ],
      "size": [
        386.8796723228355,
        88
      ],
      "flags": {},
      "order": 1,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "properties": {},
      "widgets_values": [
        "Fast Groups Muter\n\n動かしたいグループノードを選択できるスイッチ。\nやりたい方のグループノードをyesにして「実行する」を押せば出力される。"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 1,
      "type": "LoadImage",
      "pos": [
        -595.5225457621673,
        3078.9270186422978
      ],
      "size": [
        344,
        314
      ],
      "flags": {
        "collapsed": false
      },
      "order": 2,
      "mode": 2,
      "inputs": [],
      "outputs": [
        {
          "name": "IMAGE",
          "type": "IMAGE",
          "links": [
            8
          ]
        },
        {
          "name": "MASK",
          "type": "MASK",
          "links": null
        }
      ],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.75",
        "Node name for S&R": "LoadImage"
      },
      "widgets_values": [
        "スクリーンショット 2025-11-28 16.44.08.png",
        "image"
      ]
    },
    {
      "id": 13,
      "type": "SaveImage",
      "pos": [
        287.41215084341087,
        3065.2793325328175
      ],
      "size": [
        314.673828125,
        270
      ],
      "flags": {},
      "order": 14,
      "mode": 2,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 9
        }
      ],
      "outputs": [],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.75"
      },
      "widgets_values": [
        "ComfyUI"
      ]
    },
    {
      "id": 2,
      "type": "PreviewImage",
      "pos": [
        245.4900895288037,
        3393.7738976179044
      ],
      "size": [
        367.2519376366588,
        449.0007223423836
      ],
      "flags": {},
      "order": 13,
      "mode": 2,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 7
        }
      ],
      "outputs": [],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.75",
        "Node name for S&R": "PreviewImage"
      },
      "widgets_values": []
    },
    {
      "id": 18,
      "type": "DirectoryLineArtExtractor",
      "pos": [
        985.4532245846751,
        3072.3749959270513
      ],
      "size": [
        376.1060546875,
        130
      ],
      "flags": {},
      "order": 3,
      "mode": 2,
      "inputs": [],
      "outputs": [
        {
          "name": "line_art_frames",
          "type": "IMAGE",
          "links": [
            20
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "DirectoryLineArtExtractor"
      },
      "widgets_values": [
        "/Users/kalin/Desktop/生成物/連番画像",
        0.3,
        true,
        3
      ]
    },
    {
      "id": 24,
      "type": "SaveAnimatedWEBP",
      "pos": [
        1831.7537876170165,
        3296.3001399543436
      ],
      "size": [
        308,
        196
      ],
      "flags": {},
      "order": 4,
      "mode": 2,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": null
        }
      ],
      "outputs": [],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.75"
      },
      "widgets_values": [
        "ComfyUI",
        6,
        true,
        80,
        "default"
      ]
    },
    {
      "id": 26,
      "type": "SaveAnimatedPNG",
      "pos": [
        1830.4536855254175,
        3115.0819363373516
      ],
      "size": [
        308,
        106
      ],
      "flags": {
        "collapsed": false
      },
      "order": 11,
      "mode": 2,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 20
        }
      ],
      "outputs": [],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.75"
      },
      "widgets_values": [
        "ComfyUI",
        6,
        4
      ]
    },
    {
      "id": 16,
      "type": "Fast Groups Muter (rgthree)",
      "pos": [
        592.4024828720559,
        2803.751299862464
      ],
      "size": [
        353.8335622054202,
        130
      ],
      "flags": {},
      "order": 5,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "OPT_CONNECTION",
          "type": "*",
          "links": null
        }
      ],
      "properties": {
        "matchColors": "",
        "matchTitle": "",
        "showNav": true,
        "showAllGraphs": true,
        "sort": "position",
        "customSortAlphabet": "",
        "toggleRestriction": "default"
      }
    },
    {
      "id": 28,
      "type": "SaveAnimatedWEBP",
      "pos": [
        778.972918263041,
        4216.447466306782
      ],
      "size": [
        308,
        196
      ],
      "flags": {},
      "order": 12,
      "mode": 0,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 21
        }
      ],
      "outputs": [],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.75"
      },
      "widgets_values": [
        "ComfyUI",
        6,
        false,
        80,
        "default"
      ]
    },
    {
      "id": 22,
      "type": "Note",
      "pos": [
        971.8405108075038,
        3301.3075978247825
      ],
      "size": [
        468.40982060490705,
        128.4779827138077
      ],
      "flags": {},
      "order": 6,
      "mode": 2,
      "inputs": [],
      "outputs": [],
      "properties": {},
      "widgets_values": [
        "【ここは連番画像が入ったフォルダの中にある全ての画像を透過させるグループノード】\n\nステップ① \ndirectory_pathに、連番画像が入ったフォルダのパスをコピペする\n※フォルダの中に入っている連番画像は全て同じ縦横比、解像度にすること。\n\nthreshold：しきい値\ninvert_input：透過を反転させる（trueにしておけば黒い線を残し、白い部分を透過させる）\nmedian_filter: 細かいゴミやノイズをぼかす値（３おすすめ）\n\nステップ②\nアニメーションPNGを保存：PNGの連番画像データとして保存される\nアニメーションWEBPを保存：WEBPデータとして保存される\n\nどちらかをノードに繋げれば良し\n"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 27,
      "type": "DirectoryCharacterMatteExtractor",
      "pos": [
        206.00715058923524,
        4215.055403083432
      ],
      "size": [
        320.071875,
        250
      ],
      "flags": {},
      "order": 7,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "links": [
            21
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "DirectoryCharacterMatteExtractor"
      },
      "widgets_values": [
        "/Users/kalin/Desktop/生成物/透過テスト連番",
        0.1,
        0.7,
        0.4,
        2,
        2,
        -1,
        35,
        11111
      ]
    },
    {
      "id": 29,
      "type": "Note",
      "pos": [
        -573.616235411432,
        4108.177652661215
      ],
      "size": [
        659.452767163064,
        941.8219754004376
      ],
      "flags": {},
      "order": 8,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "properties": {},
      "widgets_values": [
        "Directory Character Matte Extractor\n\nスキャンした線画や、白い（または黄ばんだ）紙の上に描かれたキャラクターの連番画像から、\nキャラクターだけを切り抜いて背景を透過 PNG にするためのカスタムノードです。\n\nフォルダに入った PNG / JPG 連番を読み込み、\n自動で「紙の色」を推定して キャラの外側の紙だけ透明化 します。\n目や服の白など、キャラの中の白は原則残すような設計になっています。\n\n使い方\n\n1コマずつスキャンした画像（PNG か JPG）を\n0001.png, 0002.png, … のような連番で1つのフォルダに入れる。\n\nComfyUI で Directory Character Matte Extractor ノードを追加し、\ndirectory_path にそのフォルダのパスを指定。\n\nノードの images 出力を\n\nSave Image（連番PNG）\n\nもしくは Save AnimatedWEBP / SaveAnimatedPNG\nに繋いで実行すると、背景が透過されたキャラ画像が書き出されます。\n\n各パラメータ\n\ndirectory_path\n読み込む連番画像フォルダのフルパス。\n中の .png / .jpg / .jpeg を自然順でまとめて処理します。\n\nbg_tolerance\n「紙の代表色とどれくらい近ければ紙とみなすか」を決めるしきい値。\n小さいほど厳しく（紙にかなり近い場所だけ抜ける）、\n大きいほどゆるく（紙に近い淡い色も抜けやすい）。\n\nvalue_min\n明るさの下限。これより暗いピクセルは紙とみなさない。\n数値を上げると、影や濃い色は確実に残る代わりに\n紙に影が落ちている部分は抜けにくくなります。\n\nsaturation_max\n彩度の上限。これより彩度が高い色は紙ではなくキャラ側と判断。\n黄ばんだ紙にも対応したい場合は少し高め、\n真っ白なコピー紙なら低めにします。\n\nclose_gaps\n輪郭線のスキマを何ピクセルぶん埋めるか。\n値を上げると、線が少し太くなり、\n腕と身体の間などから背景が漏れ込みにくくなります。\n\nedge_feather\n抜いたアルファの輪郭をどれくらいぼかすか。\n0 だとカチッとした切り抜き、\n1〜2 だと白フチが自然になじみます。\n\nmatte_shift\n抜きマット全体を内側／外側にシフトする量。\nプラスで内側に食い込ませて白フチを消し、\nマイナスで外側に広げて「欠け」を防ぎます。\n\nmin_foreground_area\nキャラ側の「島」の最小ピクセル数。\nこれより小さい前景の点はゴミとみなして削除します\n（スキャン時のホコリ・チリ消し用）。\n\nmin_hole_area\nキャラ内部にある「紙色の穴」の最小サイズ。\nこれより大きい穴は背景として抜き、\n小さい穴（目のハイライトなど）は残します。\n値を大きくすると穴抜きが弱くなり、\nとても大きくするとほぼ無効化されます。\n\nコツ\n\nまずは min_hole_area を大きめ（例: 10000）にして、\n「外側の紙だけ」きれいに抜ける設定を探すと安全です。\n\nそのあとで腕と体の隙間などを抜きたければ、\nmin_hole_area を少しずつ下げていくと\n「抜きたい穴だけ抜けるライン」が見つかりやすいです。\n\n紙が黄ばんでいるスキャンの場合は、\nsaturation_max を少し高め（0.3〜0.4）にしておくと安定します。"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 30,
      "type": "SaveAnimatedPNG",
      "pos": [
        780.6950126943688,
        4481.625386878437
      ],
      "size": [
        308,
        106
      ],
      "flags": {},
      "order": 9,
      "mode": 0,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": null
        }
      ],
      "outputs": [],
      "properties": {
        "cnr_id": "comfy-core",
        "ver": "0.3.75"
      },
      "widgets_values": [
        "ComfyUI",
        6,
        4
      ]
    }
  ],
  "links": [
    [
      7,
      12,
      0,
      2,
      0,
      "IMAGE"
    ],
    [
      8,
      1,
      0,
      12,
      0,
      "IMAGE"
    ],
    [
      9,
      12,
      0,
      13,
      0,
      "IMAGE"
    ],
    [
      20,
      18,
      0,
      26,
      0,
      "IMAGE"
    ],
    [
      21,
      27,
      0,
      28,
      0,
      "IMAGE"
    ]
  ],
  "groups": [
    {
      "id": 1,
      "title": "画像の透過",
      "bounding": [
        -657.8011216025303,
        2974.511406561284,
        1354.649059287557,
        888.619846369772
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 2,
      "title": "連番画像",
      "bounding": [
        856.3434956705464,
        2972.879130320362,
        1584.4491282312506,
        896.702693392323
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 3,
      "title": "色付きキャラ白背景透過",
      "bounding": [
        -650.6377093003367,
        3969.6541078677787,
        3103.4004862178385,
        1127.0728851567947
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    }
  ],
  "config": {},
  "extra": {
    "ds": {
      "scale": 0.2838944946017032,
      "offset": [
        2448.4604225647386,
        -2787.658607036047
      ]
    },
    "frontendVersion": "1.30.6"
  },
  "version": 0.4
}